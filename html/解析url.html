<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let str =
        "http://www.domain.com/?user=anonymous&id=123&id=456&city=%E5%8C%97%E4%BA%AC&d&enabled&id=1234";

        var searchParams = new URLSearchParams(str);

//Iterate the search parameters.
      for (let p of searchParams) {
        console.log(p);
      }

      let result = {
        user: "anonymous",
        id: [123, 456], // 重复出现的 key 要组装成数组，能被转成数字的就转成数字类型
        city: "北京", // 中文
        enabled: true // 未指定值的 key 约定值为 true
      };

      // function parse(str) {
      //   var obj = {};
      //   var ary = str.split("&");
      //   console.log(ary);
      //   for (var i = 0; i < ary.length; i++) {
      //     var tmp = ary[i].split("=");
      //     if (!obj[tmp[0]]) {
      //       obj[tmp[0]] = tmp[1] || true;
      //     } else {
      //       var tmp2 = [obj[tmp[0]], tmp[1] || true];
      //       obj[tmp[0]] = tmp2;
      //     }
      //   }

      //   return obj;
      // }
      function parse(str) {
  var paramObj = {};
  // var paramArr = decodeURI(str).split('&');  // 先解码
   var searchParams = new URLSearchParams(str);

//Iterate the search parameters.
for (let tmp of searchParams) {
    var key = tmp[0];
    var value = tmp[1] || true;
    if (typeof paramObj[key] === 'undefined') { // 判断 key 是否存在
      paramObj[key] = value;
    } else {
      var newValue = Array.isArray(paramObj[key]) ? paramObj[key] : [paramObj[key]];  // 正确处理数组
      newValue.push(value);
      paramObj[key] = newValue;
    }
}
  // for (var i = 0; i < paramArr.length; i++) {
  //   var tmp = paramArr[i].split('=');
  //   var key = tmp[0];
  //   var value = tmp[1] || true;
  //   if (typeof paramObj[key] === 'undefined') { // 判断 key 是否存在
  //     paramObj[key] = value;
  //   } else {
  //     var newValue = Array.isArray(paramObj[key]) ? paramObj[key] : [paramObj[key]];  // 正确处理数组
  //     newValue.push(value);
  //     paramObj[key] = newValue;
  //   }
  // }

  return paramObj;
}

// function parse(str) {
//   if (typeof str !== 'string') {
//     return {};
//   }

//   return decodeURI(str).split('&').map(param => {
//     const tmp = param.split('=');
//     const key = tmp[0];
//     let value = tmp[1] || true;
//     if (typeof value === 'string' && isNaN(Number(value)) === false) {
//       value = Number(value);
//     }

//     return { key, value };
//   }).reduce((params, item) => {
//     const { key, value } = item;
//     if (typeof params[key] === 'undefined') {
//       params[key] = value;
//     } else {
//       params[key] = Array.isArray(params[key]) ? params[key] : [params[key]];
//       params[key].push(value);
//     }

//     return params;
//   }, {});
// }

      console.log(parse(str));
    </script>
  </body>
</html>
